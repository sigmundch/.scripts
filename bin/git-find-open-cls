#!/usr/bin/env dart
import 'dart:io' show Process;

/// This script finds landed `git cl` branches and prints them.
/// The output can be piped to `xargs git branch -D` for example.
main() {
  var result = Process.runSync('git', ['config', '-l']);
  if (result.exitCode != 0) exit(result.exitCode);
  var matches = new RegExp(r'^branch\.(\w+)\.(\w+)=', multiLine: true)
      .allMatches(result.stdout);
  var info = {};
  for (var match in matches) {
    info.putIfAbsent(match[1], () => new Set()).add(match[2]);
  }
  info.forEach((branch, keys) {
    if (keys.contains('rietveldserver') && keys.contains('rietveldissue')) {
      // Branch was not landed
      print(branch);
    }
  });
}
